# ğŸ”§ Session ç®¡ç†æ”¹è¿›æ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

ç”¨æˆ·æŠ¥å‘Šï¼š**ç‚¹å‡»å…¶ä»–ç•Œé¢åè¿‡ä¸€æ®µæ—¶é—´åˆè‡ªåŠ¨å›åˆ°ç™»å½•ç•Œé¢**

### åŸå› åˆ†æ

1. **Session æ£€æŸ¥è¿‡äºé¢‘ç¹**: åŸæ¥æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ session çŠ¶æ€
2. **è¿‡æœŸæ—¶é—´éªŒè¯è¿‡äºä¸¥æ ¼**: æ²¡æœ‰å®¹é”™æœºåˆ¶ï¼Œæ—¶é’Ÿå·®å¼‚å¯èƒ½å¯¼è‡´è¯¯åˆ¤
3. **ç½‘ç»œé”™è¯¯å¯¼è‡´è¯¯ç™»å‡º**: ä¸´æ—¶ç½‘ç»œé—®é¢˜è¢«è¯¯è®¤ä¸º session å¤±æ•ˆ
4. **Token åˆ·æ–°æœºåˆ¶ä¸å¤Ÿæ™ºèƒ½**: æ²¡æœ‰ä¸»åŠ¨åˆ·æ–°å³å°†è¿‡æœŸçš„ token

## ğŸ› ï¸ å·²å®æ–½çš„æ”¹è¿›

### 1. **å»¶é•¿æ£€æŸ¥é—´éš”**
- **ä¹‹å‰**: æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
- **ç°åœ¨**: æ¯15åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
- **æ•ˆæœ**: å‡å°‘äº†é¢‘ç¹çš„ç½‘ç»œè¯·æ±‚å’Œè¯¯åˆ¤

### 2. **å¢åŠ è¿‡æœŸæ—¶é—´å®¹é”™**
```typescript
// å¢åŠ 5åˆ†é’Ÿçš„å®¹é”™æ—¶é—´ï¼Œé¿å…æ—¶é’Ÿå·®å¼‚å¯¼è‡´çš„è¯¯åˆ¤
const gracePeriod = 5 * 60; // 5åˆ†é’Ÿå®¹é”™æ—¶é—´

if (sessionExpiresAt && currentTime > (sessionExpiresAt + gracePeriod)) {
  // åªæœ‰è¶…è¿‡å®¹é”™æ—¶é—´æ‰çœŸæ­£ç™»å‡º
}
```

### 3. **æ™ºèƒ½ Token åˆ·æ–°**
```typescript
if (status.timeUntilExpiry && status.timeUntilExpiry < 5 * 60) {
  // å¦‚æœ5åˆ†é’Ÿå†…å³å°†è¿‡æœŸï¼Œè‡ªåŠ¨å°è¯•åˆ·æ–°
  const { data: { session: refreshedSession } } = await supabase.auth.refreshSession();
  if (refreshedSession) {
    setSession(refreshedSession);
  }
}
```

### 4. **å¢å¼ºé”™è¯¯å®¹é”™**
- ç½‘ç»œé”™è¯¯ä¸ç«‹å³ç™»å‡ºç”¨æˆ·
- åªæœ‰æ˜ç¡®çš„è®¤è¯é”™è¯¯æ‰è§¦å‘ç™»å‡º
- å¢åŠ é‡è¯•æœºåˆ¶å’Œé”™è¯¯åˆ†ç±»

### 5. **Session ç›‘æ§å·¥å…·**
æ–°å¢ `SessionMonitor` å·¥å…·ç±»ï¼Œæä¾›ï¼š
- è¯¦ç»†çš„ session çŠ¶æ€æ£€æŸ¥
- è°ƒè¯•ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®
- å¼€å‘ç¯å¢ƒä¸‹çš„å®æ—¶ç›‘æ§

## ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•

### åœ¨å¼€å‘ç¯å¢ƒä¸‹çš„è°ƒè¯•

1. **æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°**
2. **ä½¿ç”¨ Session Monitor**:
   ```javascript
   // æ£€æŸ¥å½“å‰ session çŠ¶æ€
   await window.sessionMonitor.logSessionInfo();
   
   // è·å–ç»Ÿè®¡ä¿¡æ¯
   window.sessionMonitor.getStats();
   ```

### ç›‘æ§ä¿¡æ¯è§£è¯»

æ§åˆ¶å°ä¼šæ˜¾ç¤ºï¼š
```
ğŸ” Session Monitor Report
  Session Status: âœ… Valid / âŒ Invalid
  Details: Session valid. Expires in X minutes
  Time until expiry: X minutes
  Check count: X
  Last check: æ—¶é—´æˆ³
```

## ğŸ“‹ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### ä¹‹å‰çš„é—®é¢˜
- âŒ é¢‘ç¹çš„è‡ªåŠ¨ç™»å‡º
- âŒ åœ¨æ­£å¸¸ä½¿ç”¨æ—¶çªç„¶å›åˆ°ç™»å½•é¡µ
- âŒ æ²¡æœ‰é¢„è­¦çš„ session è¿‡æœŸ

### ç°åœ¨çš„æ”¹è¿›
- âœ… æ›´é•¿çš„ session ä¿æŒæ—¶é—´
- âœ… æ™ºèƒ½çš„ token è‡ªåŠ¨åˆ·æ–°
- âœ… å®¹é”™æœºåˆ¶é¿å…è¯¯åˆ¤
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†
- âœ… å¼€å‘ç¯å¢ƒä¸‹çš„è°ƒè¯•å·¥å…·

## ğŸ¯ å®é™…æ•ˆæœ

### Session ç”Ÿå‘½å‘¨æœŸç®¡ç†
1. **ç™»å½•å**: Session æ­£å¸¸ä¿æŒï¼Œè‡ªåŠ¨åˆ·æ–° token
2. **ä½¿ç”¨è¿‡ç¨‹ä¸­**: æ¯15åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼Œæ™ºèƒ½åˆ·æ–°
3. **å³å°†è¿‡æœŸ**: 5åˆ†é’Ÿå‰è‡ªåŠ¨åˆ·æ–°ï¼Œæ— æ„ŸçŸ¥ç»­æœŸ
4. **çœŸæ­£è¿‡æœŸ**: 5åˆ†é’Ÿå®¹é”™æœŸåæ‰ç™»å‡º

### é”™è¯¯å¤„ç†
- **ç½‘ç»œé”™è¯¯**: ä¸ç«‹å³ç™»å‡ºï¼Œç­‰å¾…ä¸‹æ¬¡æ£€æŸ¥
- **è®¤è¯é”™è¯¯**: æ˜ç¡®çš„é”™è¯¯æ‰è§¦å‘ç™»å‡º
- **æ—¶é’Ÿå·®å¼‚**: 5åˆ†é’Ÿå®¹é”™æ—¶é—´é¿å…è¯¯åˆ¤

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 1. **ç”¨æˆ·é€šçŸ¥**
è€ƒè™‘åœ¨ session å³å°†è¿‡æœŸæ—¶æ˜¾ç¤ºæ¸©å’Œçš„æé†’ï¼š
```typescript
if (timeUntilExpiry < 10 * 60) {
  // æ˜¾ç¤º"å³å°†è¿‡æœŸ"çš„æ¸©å’Œæé†’
}
```

### 2. **ç¦»çº¿æ”¯æŒ**
å¢åŠ ç¦»çº¿çŠ¶æ€æ£€æµ‹ï¼Œåœ¨ç¦»çº¿æ—¶æš‚åœ session æ£€æŸ¥ã€‚

### 3. **ç”¨æˆ·æ´»åŠ¨æ£€æµ‹**
æ ¹æ®ç”¨æˆ·æ´»åŠ¨æƒ…å†µè°ƒæ•´æ£€æŸ¥é¢‘ç‡ï¼š
- æ´»è·ƒç”¨æˆ·ï¼šæ­£å¸¸æ£€æŸ¥
- éæ´»è·ƒç”¨æˆ·ï¼šå‡å°‘æ£€æŸ¥é¢‘ç‡

## ğŸ”§ æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶é‡åˆ°è‡ªåŠ¨ç™»å‡º

1. **æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°**:
   ```javascript
   await window.sessionMonitor.logSessionInfo();
   ```

2. **æŸ¥çœ‹ session è¯¦æƒ…**:
   ```javascript
   const session = await supabase.auth.getSession();
   console.log('Current session:', session);
   ```

3. **æ¸…é™¤æµè§ˆå™¨æ•°æ®** (æœ€åæ‰‹æ®µ):
   ```javascript
   localStorage.clear();
   sessionStorage.clear();
   // ç„¶åé‡æ–°ç™»å½•
   ```

## âœ… éƒ¨ç½²çŠ¶æ€

**çŠ¶æ€**: âœ… **å·²éƒ¨ç½²å¹¶ç”Ÿæ•ˆ**

æ‰€æœ‰æ”¹è¿›å·²éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œç”¨æˆ·ç°åœ¨åº”è¯¥ä½“éªŒåˆ°ï¼š
- æ›´ç¨³å®šçš„ç™»å½•çŠ¶æ€
- å‡å°‘ä¸å¿…è¦çš„è‡ªåŠ¨ç™»å‡º
- æ›´æµç•…çš„ä½¿ç”¨ä½“éªŒ

---

**æ”¹è¿›å®Œæˆæ—¶é—´**: 2025-07-23 06:55:25 GMT  
**ç”Ÿæ•ˆèŒƒå›´**: æ‰€æœ‰ç”¨æˆ·  
**ç›‘æ§çŠ¶æ€**: æŒç»­ç›‘æ§ä¸­ 